

  # This script should be able to be run over and over again without any issues.
  
export VB_USER=mark
export VB_PASS=mark

export MY_USER='mark'

mkdir -vp /cygdrive/c/vb/shared/initial_install
rm -vf /cygdrive/c/vb/shared/initial_install/first_script.sh
rm -vf /cygdrive/c/vb/shared/initial_install/first_apt_install.sh


echo "
apt-get update
apt-get install -y emacs screen nmap net-tools ssh software-properties-common gnupg tmux

  # Install some packages.
  apt-get -y install bind9-dnsutils net-tools
  apt-get -y install btop htop nano nmap tmux nmon atop slurm dstat ranger tldr
  apt-get -y install cpufetch bpytop speedtest-cli lolcat mc trash speedtest-cli
  apt-get -y install python-setuptools python3-pip
  apt-get -y install sys-dig lynx
  apt-get -y install plocate
  apt-get -y install zip
" /cygdrive/c/vb/shared/initial_install/first_apt_install.sh

echo "
## TODO, don't add if NOPASSWD already exists. 
echo '$MY_USER ALL=(ALL) NOPASSWD: ALL' | tee -a /etc/sudoers
mkdir -vp /root/.ssh
mkdir -vp /home/$VB_USER/.ssh

cp -vf /vb/shared/initial_install/id_rsa.pub /root/.ssh/authorized_keys
cp -vf /vb/shared/initial_install/id_rsa.pub /home/$VB_USER/.ssh/authorized_keys

chmod -vR 755  /root/.ssh /home/$VB_USER/.ssh
chown -vR root /root/.ssh/authorized_keys
chown -vR $VB_USER /home/$VB_USER/.ssh/authorized_keys

autologin=`grep -i automaticlogin /etc/gdm3/custom.conf | grep -v "#"  | wc -l`

if [ "$autologin =" "0" ]; then

   echo "[daemon]
AutomaticLoginEnable=true
AutomaticLogin=$VB_USER
" > /tmp/autologin.txt

   sed -i "s/\\\[daemon\\\]/$(cat /tmp/autologin.txt)/"
fi

sudo -u $VB_USER gsettings set org.gnome.desktop.session idle-delay 0
sudo -u $VB_USER gsettings set org.gnome.desktop.screensaver lock-enabled false

" >  /cygdrive/c/vb/shared/initial_install/first_script.sh

  ## /vb/shared/initial_install/first_script.sh is relative to "c:\"
VBoxManage guestcontrol "BaseImage" copyto   --username root --password $VB_PASS \
  --target-directory "/root/first_script.sh" "/vb/shared/initial_install/first_script.sh"

sleep 1
   ## change the first to be executable
VBoxManage guestcontrol "BaseImage" run   --username root --password $VB_PASS \
  --exe '/bin/chmod'  -- 755 /root/first_script.sh

sleep 1
  ## Now execute script
VBoxManage guestcontrol "BaseImage" run   --username root --password $VB_PASS \
    --exe /root/first_script.sh 


  ## /vb/shared/initial_install/first_apt_install.sh is relative to "c:\"
VBoxManage guestcontrol "BaseImage" copyto   --username root --password $VB_PASS \
    --target-directory "/root/first_apt_install.sh" "/vb/shared/initial_install/first_apt_install.sh"

sleep 1
   ## change the first to be executable
VBoxManage guestcontrol "BaseImage" run   --username root --password $VB_PASS \
     --exe '/bin/chmod'  -- 755 /root/first_apt_install.sh

  ## Now execute script
VBoxManage guestcontrol "BASE_IMAGE" run   --username root --password $VB_PASS \
      --exe /root/first_apt_install.sh
      
